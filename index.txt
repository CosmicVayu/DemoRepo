This is the code for version 2 software